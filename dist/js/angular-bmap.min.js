!function(){"use strict";angular.module("BmapService").service("BmapCommonService",function(t,e,n){var a,o;this.createScript=function(o,i){return a||(a=n(function(n,a){t.initMap=function(){n()};var r=document.createElement("script");r.src="http://api.map.baidu.com/api?v="+o+"&ak="+i+"&callback=initMap",e[0].body.appendChild(r)}))},this.loadMap=function(t){o=new BMap.Map(t);var e=new BMap.Point(116.404,39.915);return o.centerAndZoom(e,15),o.enableScrollWheelZoom(!0),o},this.addControl=function(t){function e(t,e){0==t?o.removeControl(e):o.addControl(e)}var n;if(t)if(t.name?null==t.add||void 0==t.add?t.add=!0:t.anchor?t.type||"navigation"==t.name&&(t.type=BMAP_NAVIGATION_CONTROL_ZOOM):t.anchor=BMAP_ANCHOR_TOP_LEFT:t.type="navigation","control"==t.name)n=new BMap.ScaleControl({anchor:t.anchor}),e(t.add,n);else if("overView"==t.name){var a=new BMap.OverviewMapControl,i=new BMap.OverviewMapControl({isOpen:!0,anchor:t.anchor});e(t.add,a),e(t.add,i)}else r=new BMap.NavigationControl({anchor:t.anchor,type:t.type}),e(t.add,r);else{var r=new BMap.NavigationControl;o.addControl(r)}},this.addScrollWheelZoom=function(t){null!=t&&void 0!=t||(t=!1),1==t?o.enableScrollWheelZoom():o.disableScrollWheelZoom()},this.addDoubleClickZoom=function(t){null!=t&&void 0!=t||(t=!1),1==t?o.enableDoubleClickZoom():o.disableDoubleClickZoom()},this.dragMap=function(t){null!=t&&void 0!=t||(t=!1),1==t?o.enableDragging():o.disableDragging()},this.setCenterAndZoom=function(t,e){t||(t="北京"),e||(e=15),o.centerAndZoom(t,e)},this.setCenter=function(t){t||(t="北京"),o.setCenter(t)},this.setCurrentCity=function(t){o.setCurrentCity(t)},this.setZoom=function(t){o.setZoom(t)},this.getZoom=function(){return o.getZoom()},this.MapPanTo=function(t){o.panTo(t)},this.getView=function(){var t=o.getBounds(),e=t.getSouthWest();return{rightBottom:t.getNorthEast(),leftTop:e}},this.isInBound=function(t){return o.getBounds().containsPoint(t)},this.setViewport=function(t){o.setViewport(t)},this.getMapcenter=function(){return o.getCenter()},this.changeMapType=function(t){t||(t=BMAP_NORMAL_MAP),o.setMapType(t)},this.getLocationByIp=function(t){(new BMap.LocalCity).get(t)},this.getLocationByBrowser=function(t){(new BMap.Geolocation).getCurrentPosition(function(e){this.getStatus()==BMAP_STATUS_SUCCESS?t(e):alert("failed"+this.getStatus())},{enableHighAccuracy:!0})}})}(),function(){"use strict";angular.module("BmapService").service("BmapDistanceToolService",function(t,e,n){var a;this.createScript=function(){return a||(a=n(function(t,n){var a=document.createElement("script");a.src="http://api.map.baidu.com/library/DistanceTool/1.2/src/DistanceTool_min.js",e[0].body.appendChild(a),a.onload=function(){t()}}))},this.openDistanceTool=function(t){var e=new BMapLib.DistanceTool(t);t.addEventListener("load",function(){e.open()})},this.closeDistanceTool=function(){},this.openAreaTool=function(t){var e=new BMapLib.DrawingManager(t,{isOpen:!1,enableDrawingTool:!1,polygonOptions:{strokeColor:"red",fillColor:"red",strokeWeight:1,strokeOpacity:.5,fillOpacity:.5,strokeStyle:"solid"}});e.addEventListener("overlaycomplete",function(e){t.removeOverlay(e.overlay),alert(isNaN(this.cal(e.overlay))?"测量有误，请您重新测量":this.cal(e.overlay)+"平方米")}),e.setDrawingMode(BMAP_DRAWING_POLYGON),e.open()},this.cal=function(t){if(!(t instanceof BMap.Polygon||t instanceof Array))return 0;var e;if((e=t instanceof BMap.Polygon?t.getPath():t).length<3)return 0;for(var n=0,a=0,o=0,i=0,r=0,c=0,l=0,s=0,u=0,h=0,d=0,p=0,M=0,f=0,m=0,v=0,g=0,y=0,B=0,P=0,b=0,C=0,S=0,w=0,O=0,I=0,T=0,A=0,N=0,k=0,x=0,L=0,_=0,Z=e.length,D=0;D<Z;D++)0==D?(a=e[Z-1].lng*Math.PI/180,o=e[Z-1].lat*Math.PI/180,i=e[0].lng*Math.PI/180,r=e[0].lat*Math.PI/180,c=e[1].lng*Math.PI/180,l=e[1].lat*Math.PI/180):D==Z-1?(a=e[Z-2].lng*Math.PI/180,o=e[Z-2].lat*Math.PI/180,i=e[Z-1].lng*Math.PI/180,r=e[Z-1].lat*Math.PI/180,c=e[0].lng*Math.PI/180,l=e[0].lat*Math.PI/180):(a=e[D-1].lng*Math.PI/180,o=e[D-1].lat*Math.PI/180,i=e[D].lng*Math.PI/180,r=e[D].lat*Math.PI/180,c=e[D+1].lng*Math.PI/180,l=e[D+1].lat*Math.PI/180),s=Math.cos(r)*Math.cos(i),u=Math.cos(r)*Math.sin(i),h=Math.sin(r),d=Math.cos(o)*Math.cos(a),p=Math.cos(o)*Math.sin(a),M=Math.sin(o),A=((C=(y=(s*s+u*u+h*h)/(s*(f=Math.cos(l)*Math.cos(c))+u*(m=Math.cos(l)*Math.sin(c))+h*(v=Math.sin(l))))*f-s)*(B=(g=(s*s+u*u+h*h)/(s*d+u*p+h*M))*d-s)+(S=y*m-u)*(P=g*p-u)+(w=y*v-h)*(b=g*M-h))/(Math.sqrt(C*C+S*S+w*w)*Math.sqrt(B*B+P*P+b*b)),A=Math.acos(A),O=S*b-w*P,I=0-(C*b-w*B),T=C*P-S*B,(0!=s?O/s:0!=u?I/u:T/h)>0?(N+=A,L++):(k+=A,x++);var E,F;return E=N+(2*Math.PI*x-k),F=2*Math.PI*L-N+k,_=N>k?E-(Z-2)*Math.PI<1?E:F:F-(Z-2)*Math.PI<1?F:E,n="6378137"*(_-(Z-2)*Math.PI)*"6378137",parseFloat(n).toFixed(1)}})}(),function(){"use strict";angular.module("BmapService").service("BmapOverlayService",function(){this.addOverlay=function(t,e){t.addOverlay(e)},this.setPosition=function(t,e){t.setPosition(e)},this.removeOverlay=function(t,e){t.removeOverlay(e)},this.removeAllOverlay=function(t){t.clearOverlays()},this.addPolyline=function(t,e,n){n=n||{strokeColor:"rgb(0,138,255)",strokeWeight:3,strokeOpacity:.8};var a=new BMap.Polyline(e,n);return t.addOverlay(a),a},this.addCircle=function(t,e,n,a){a=a||{strokeColor:"red",strokeWeight:2,strokeOpacity:.5},e=e||500;var o=new BMap.Circle(n,e,a);return t.addOverlay(o),o},this.addIcon=function(t,e,n,a,o,i){i=i||{imageOffset:new BMap.Size(0,0),anchor:new BMap.Size(n/2,a)};var r=new BMap.Icon(e,new BMap.Size(n,a),i),c=new BMap.Marker(o,{icon:r});return t.addOverlay(c),c},this.addLabel=function(t,e,n,a,o){n=n||{offset:new BMap.Size(30,-30)},o=o||{fontSize:"12px",height:"20px",lineHeight:"20px",fontFamily:"微软雅黑"};var i=new BMap.Label(e,n);return i.setStyle(o),i.setPosition(a),t.addOverlay(i),i},this.setPosMarker=function(t,e,n,a){t.centerAndZoom(a,13);var o=new BMap.Marker(a,{icon:new BMap.Icon("./"+n,new BMap.Size(16,16),{imageOffset:new BMap.Size(0,0)})});t.addOverlay(o);var i=new BMap.Label(e,{offset:new BMap.Size(10,-4)});i.setStyle({color:"9f9e9e",fontSize:"12px",height:"18px",border:"1px #dddddd solid",zIndex:"-6167248",padding:"1px 10px 1px 10px",fontFamily:"微软雅黑",opacity:0,textAlign:"center",backgroundColor:"#ffffff"}),o.addEventListener("mouseover",function(){i.setStyle({opacity:1})},!1),o.addEventListener("mouseout",function(){i.setStyle({opacity:0})},!1),o.setLabel(i)}})}(),function(){"use strict";angular.module("BmapService",[])}(),function(){"use strict";angular.module("BmapService").service("BmapTrafficService",function(t,e,n){var a;this.createScript=function(){return a||(a=n(function(t,n){var a=document.createElement("script"),o=document.createElement("link");o.href="http://api.map.baidu.com/library/TrafficControl/1.4/src/TrafficControl_min.css",o.rel="stylesheet",a.src="http://api.map.baidu.com/library/TrafficControl/1.4/src/TrafficControl_min.js",e[0].body.appendChild(a),e[0].head.appendChild(o),a.onload=function(){t()}}))},this.addTraffic=function(t,e,n){var a=new BMapLib.TrafficControl({showPanel:!1});n||(n=BMAP_ANCHOR_BOTTOM_RIGHT),a.setAnchor(n),0==e?t.removeControl(a):t.addControl(a)}})}(),function(){"use strict";angular.module("BmapService").service("BmapTransformService",function(t,e,n){var a=52.35987755982988;this.baiduToGoogle=function(t){try{var e=t.lng-.0065,n=t.lat-.006,o=Math.sqrt(e*e+n*n)-2e-5*Math.sin(n*a),i=Math.atan2(n,e)-3e-6*Math.cos(e*a),r=Number(Number(o*Math.cos(i)).toFixed(6)),c=Number(Number(o*Math.sin(i)).toFixed(6));return a=null,e=null,n=null,o=null,i=null,{lng:r,lat:c}}catch(t){console.log(t)}},this.googleToBaidu=function(t,e){var n=Math.sqrt(t*t+e*e)+2e-5*Math.sin(e*a),o=Math.atan2(e,t)+3e-6*Math.cos(t*a),i=Number(Number(n*Math.cos(o)+.0065).toFixed(6)),r=Number(Number(n*Math.sin(o)+.006).toFixed(6));return new BMap.Point(i,r)},this.multiGoogleToBaidu=function(t){for(var e=new Array,n=0;n<t.length;n++){var o=t[n],i=o.lng,r=o.lat,c=Math.sqrt(i*i+r*r)+2e-5*Math.sin(r*a),l=Math.atan2(r,i)+3e-6*Math.cos(i*a),s=Number(Number(c*Math.cos(l)+.0065).toFixed(6)),u=Number(Number(c*Math.sin(l)+.006).toFixed(6)),h=new BMap.Point(s,u);e.push(h)}return e},this.getLocation=function(t,a,o,i){var r="http://api.map.baidu.com/geocoder/v2/?ak="+t+"&output=json&location="+a+","+o+"&coordtype="+(i=i||"gcj02ll");return e({method:"JSONP",url:n.trustAsResourceUrl(r)})}})}();